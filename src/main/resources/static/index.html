<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>Hello, WebVR! • A-Frame</title>
  <meta name="description" content="Hello, WebVR! • A-Frame">
  <script src="https://aframe.io/releases/1.0.2/aframe.min.js"></script>
  <script src="https://unpkg.com/aframe-slice9-component/dist/aframe-slice9-component.min.js"></script>
  <!-- <script src="https://rawgit.com/mayognaise/aframe-mouse-cursor-component/master/dist/aframe-mouse-cursor-component.min.js"></script> -->
  <script src="https://unpkg.com/aframe-look-at-component@0.8.x/dist/aframe-look-at-component.min.js"></script>


  <script>

    AFRAME.registerComponent('modify-chess-figure', {
      init: function () {

        // inside an a-frame component
        var acamera = document.querySelector("#a-camera")
        var direction = new THREE.Vector3();

        // move forward in camera direction for mouse scroll wheel
        window.addEventListener("wheel", event => {
            const delta = Math.sign(event.wheelDelta);
            // getting the mouse wheel change (120 or -120 and normalizing it to 1 or -1)

            // get the cameras world direction
            this.el.sceneEl.camera.getWorldDirection(direction);
            direction.multiplyScalar(0.1);

            var pos = acamera.object3D.position;
            pos.x += delta * direction.x;
            // pos.y += delta * direction.y // comment this to get 2D movement
            pos.z += delta * direction.z;
        });

        this.el.addEventListener('click', function (evt) {
          // this.setAttribute('material', 'color', '#FFF');
          var vectorChessFig = this.getAttribute('position');

          this.setAttribute('position', { x: vectorChessFig.x + 4, y: vectorChessFig.y, z: vectorChessFig.z });
        });

        this.el.addEventListener('mouseenter', function (evt) {
          document.querySelector('#overlay').setAttribute('visible', true);
        });
        this.el.addEventListener('mouseleave', function (evt) {
          document.querySelector('#overlay').setAttribute('visible', false);
        });

      }
    });
  </script>
</head>

<body>
  <a-scene>
    <a-assets>
      <img id="sliceImg" src="/assets/img/slice.png">
      <a-mixin id="slice" slice9="color: #050505; src: #sliceImg; left: 50; right: 52; top: 50; bottom: 52;"></a-mixin>
      <a-asset-item id="chessModel" src="/assets/archive/4.88_chess_scene.gltf"></a-asset-item>
    </a-assets>
    <a-entity gltf-model="#chessModel" position="1 -5 -20"></a-entity>
    <a-box modify-chess-figure position="-1 0.5 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>

    <a-entity camera id="a-camera" look-controls cursor="rayOrigin: mouse">
      <!-- <a-entity cursor="fuse: true; fuseTimeout: 500" position="0 0 -1"
        geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03;" material="color: black">
      </a-entity> -->
    </a-entity>

    <a-entity id="overlay" visible="false" mixin="slice" position="1.3 1.6 -2"
      slice9="color: #111; width: 5; height: 3;"
      text="color: #4ef580; width: 6; x-offset: 1; value: The eggs have been found!\nExplore the OASIS!;"
      look-at="[camera]">
    </a-entity>

  </a-scene>
</body>

</html>